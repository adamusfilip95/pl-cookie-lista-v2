<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mojra – Zgoda na pliki cookie (PL, PRETTY)</title>

  <!-- 1) Consent Mode V2: DEFAULT (musí běžet dřív než se načte gtag.js) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      functionality_storage: 'granted',
      security_storage: 'granted'
    });
  </script>

  <!-- 2) gtag.js – načíst jednou (GA4 ID PL) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E8L8HY25GB"></script>
  <script>
    gtag('js', new Date());

    // GA4 – Polska
    gtag('config', 'G-E8L8HY25GB', {
      wait_for_update: 500
    });

    // Google Ads – Polska
    gtag('config', 'AW-10853105582', {
      wait_for_update: 500
    });
  </script>
</head>

<body>
  <!-- 3) COOKIE BANNER (CSS + HTML + JS) – UI v polštině -->
  <style>
    :root {
      --ccy-primary: #49A4EE;
      --ccy-dark: #222;
      --ccy-light: #fff;
      --ccy-border: #e5e5e5;
    }
    .ccy-hidden { display: none !important; }
    .ccy-banner, .ccy-modal-backdrop {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      box-sizing: border-box;
    }
    .ccy-banner {
      position: fixed; inset: auto 0 0 0; z-index: 9999;
      background: var(--ccy-light); color: var(--ccy-dark);
      border-top: 1px solid var(--ccy-border);
      padding: 16px; box-shadow: 0 -6px 24px rgba(0,0,0,.08);
    }
    .ccy-banner__wrap { max-width: 1200px; margin: 0 auto; display: flex; gap: 16px; align-items: center; }
    .ccy-banner__text { flex: 1 1 auto; min-width: 0; font-size: 14px; line-height: 1.5; }
    .ccy-banner__title { font-weight: 700; margin-bottom: 6px; }
    .ccy-banner__actions { display: flex; gap: 8px; align-items: center; flex-wrap: nowrap; flex-shrink: 0; }
    .ccy-btn {
      appearance: none; border: 1px solid var(--ccy-border); background: #f9f9f9; color: var(--ccy-dark);
      padding: 10px 14px; border-radius: 8px; font-size: 14px; line-height: 1; min-height: 40px; cursor: pointer;
      transition: transform .12s ease, filter .12s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px; white-space: nowrap;
    }
    .ccy-btn--primary { background: var(--ccy-primary); color: var(--ccy-light); border-color: var(--ccy-primary); }
    .ccy-btn--primary:hover { filter: brightness(.95); transform: translateY(-1px); }
    .ccy-btn--ghost { background: var(--ccy-light); }
    .ccy-btn:focus { outline: 3px solid rgba(73,164,238,.18); outline-offset: 3px; }
    .ccy-modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,.42); z-index: 10000;
      display: flex; align-items: center; justify-content: center; padding: 16px;
    }
    .ccy-modal { background: #fff; border-radius: 12px; width: 100%; max-width: 720px; box-shadow: 0 12px 40px rgba(0,0,0,.20); overflow: hidden; }
    .ccy-modal__header { padding: 18px 22px; border-bottom: 1px solid #f1f1f1; }
    .ccy-modal__title { margin: 0; font-size: 18px; font-weight: 700; color: var(--ccy-dark); }
    .ccy-modal__body { padding: 14px 22px 8px 22px; max-height: 68vh; overflow: auto; }
    .ccy-group { border: 1px solid #f1f1f1; border-radius: 10px; padding: 12px; margin: 10px 0; background: #fff; }
    .ccy-group h4 { margin: 0 0 6px 0; font-size: 15px; color: var(--ccy-dark); }
    .ccy-group p { margin: 0; font-size: 13px; color: #555; }
    .ccy-switch { display: flex; align-items: center; gap: 12px; margin-top: 10px; }
    .ccy-switch input[type=checkbox] { accent-color: var(--ccy-primary); width: 18px; height: 18px; cursor: pointer; }
    .ccy-modal__footer { padding: 14px 22px; border-top: 1px solid #f1f1f1; display: flex; gap: 8px; justify-content: flex-end; }
    .ccy-inline-note, .ccy-required { font-size: 12px; color: #666; }
    .ccy-manage-trigger {
      position: fixed; left: 16px; bottom: 16px; z-index: 9998;
      background: var(--ccy-primary); border: 1px solid var(--ccy-primary); border-radius: 50%;
      width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,.15); cursor: pointer;
    }
    .ccy-manage-trigger svg { width: 26px; height: 26px; fill: #fff; }
    .ccy-manage-trigger:hover { filter: brightness(.9); transform: translateY(-2px); }
    @media (max-width: 640px) {
      .ccy-banner__wrap { flex-direction: column; align-items: stretch; gap: 12px; }
      .ccy-banner__actions { width: 100%; flex-wrap: wrap; gap: 10px; }
      .ccy-btn { flex: 1 1 100%; width: 100%; }
    }
  </style>

  <!-- Banner -->
  <div id="ccy-banner" class="ccy-banner ccy-hidden" role="dialog" aria-live="polite" aria-label="Zgoda na pliki cookie">
    <div class="ccy-banner__wrap">
      <div class="ccy-banner__text">
        <div class="ccy-banner__title">Używamy plików cookie</div>
        Dla lepszego działania serwisu, pomiaru ruchu i personalizacji reklam. „Niezbędne” pliki cookie są używane zawsze.
        <a href="https://mojra.pl/page/cookies" target="_blank" rel="noopener noreferrer">Więcej informacji</a>
      </div>
      <div class="ccy-banner__actions" aria-label="Akcje zgody">
        <button type="button" class="ccy-btn" id="ccy-reject">Odrzuć</button>
        <button type="button" class="ccy-btn ccy-btn--ghost" id="ccy-settings">Ustawienia</button>
        <button type="button" class="ccy-btn ccy-btn--primary" id="ccy-accept">Akceptuj wszystko</button>
      </div>
    </div>
  </div>

  <!-- Tlačítko vlevo dole -->
  <button id="ccy-manage" class="ccy-manage-trigger ccy-hidden" aria-label="Zarządzaj plikami cookie">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 2a10 10 0 1 0 10 10 6 6 0 0 1-6-6 6 6 0 0 1-4-4zm-3 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm8 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-4 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-5-2a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
    </svg>
  </button>

  <!-- Modal -->
  <div id="ccy-modal-wrap" class="ccy-modal-backdrop ccy-hidden" role="dialog" aria-modal="true" aria-label="Ustawienia plików cookie">
    <div class="ccy-modal" role="document">
      <div class="ccy-modal__header">
        <h3 class="ccy-modal__title">Ustawienia zgody</h3>
      </div>

      <div class="ccy-modal__body">
        <div class="ccy-group">
          <h4>Niezbędne</h4>
          <p>Zapewniają bezpieczeństwo i podstawowe funkcje serwisu.</p>
          <div class="ccy-required">Zawsze włączone</div>
        </div>

        <div class="ccy-group">
          <h4>Analityczne</h4>
          <label class="ccy-switch">
            <input type="checkbox" id="ccy-analytics" /> Włącz
          </label>
        </div>

        <div class="ccy-group">
          <h4>Przechowywanie reklam</h4>
          <label class="ccy-switch">
            <input type="checkbox" id="ccy-adstorage" /> Włącz
          </label>
        </div>

        <div class="ccy-group">
          <h4>Dane użytkownika do reklam</h4>
          <label class="ccy-switch">
            <input type="checkbox" id="ccy-aduserdata" /> Włącz
          </label>
        </div>

        <div class="ccy-group">
          <h4>Personalizacja reklam</h4>
          <label class="ccy-switch">
            <input type="checkbox" id="ccy-adpersonalization" /> Włącz
          </label>
        </div>

        <p class="ccy-inline-note">
          Możesz zmienić wybór w każdej chwili, klikając okrągły przycisk w lewym dolnym rogu.<br />
          <a href="https://mojra.pl/page/cookies" target="_blank" rel="noopener noreferrer">Więcej o plikach cookie i ich celach</a>
        </p>
      </div>

      <div class="ccy-modal__footer">
        <button type="button" class="ccy-btn" id="ccy-cancel">Zamknij</button>
        <button type="button" class="ccy-btn ccy-btn--ghost" id="ccy-deny-all">Odrzuć wszystko</button>
        <button type="button" class="ccy-btn ccy-btn--primary" id="ccy-save">Zapisz ustawienia</button>
      </div>
    </div>
  </div>

  <script>
    // --- Config & helpers ---
    const KEY   = 'mojra_consent_v2_pl';
    const DAYS  = 180;
    const now   = () => Math.floor(Date.now() / 1000);
    const toSec = d => d * 24 * 60 * 60;

    function saveConsent(c) { try { localStorage.setItem(KEY, JSON.stringify({ ...c, ts: now() })); } catch (e) {} }
    function loadConsent() {
      try {
        const raw = localStorage.getItem(KEY);
        if (!raw) return null;
        const p = JSON.parse(raw);
        if (!p.ts || now() - p.ts > toSec(DAYS)) return null;
        return {
          analytics:          !!p.analytics,
          adstorage:          !!p.adstorage,
          aduserdata:         !!p.aduserdata,
          adpersonalization:  !!p.adpersonalization
        };
      } catch (e) { return null; }
    }

    function applyConsent(c) {
      gtag('consent', 'update', {
        analytics_storage:     c.analytics ? 'granted' : 'denied',
        ad_storage:            c.adstorage ? 'granted' : 'denied',
        ad_user_data:          c.aduserdata ? 'granted' : 'denied',
        ad_personalization:    c.adpersonalization ? 'granted' : 'denied',
        functionality_storage: 'granted',
        security_storage:      'granted'
      });
    }

    // --- Elements ---
    const $banner   = document.getElementById('ccy-banner');
    const $modal    = document.getElementById('ccy-modal-wrap');
    const $manage   = document.getElementById('ccy-manage');

    const $accept   = document.getElementById('ccy-accept');
    const $reject   = document.getElementById('ccy-reject');
    const $settings = document.getElementById('ccy-settings');
    const $save     = document.getElementById('ccy-save');
    const $denyAll  = document.getElementById('ccy-deny-all');
    const $cancel   = document.getElementById('ccy-cancel');

    const $cbA   = document.getElementById('ccy-analytics');
    const $cbAS  = document.getElementById('ccy-adstorage');
    const $cbAU  = document.getElementById('ccy-aduserdata');
    const $cbAP  = document.getElementById('ccy-adpersonalization');

    // --- UI helpers ---
    const showBanner = () => $banner.classList.remove('ccy-hidden');
    const hideBanner = () => $banner.classList.add('ccy-hidden');
    const openModal  = () => $modal.classList.remove('ccy-hidden');
    const closeModal = () => $modal.classList.add('ccy-hidden');
    const showManage = () => $manage.classList.remove('ccy-hidden');
    const hideManage = () => $manage.classList.add('ccy-hidden');

    const readForm = () => ({
      analytics:         $cbA.checked,
      adstorage:         $cbAS.checked,
      aduserdata:        $cbAU.checked,
      adpersonalization: $cbAP.checked
    });

    function setForm(c) {
      $cbA.checked  = !!c.analytics;
      $cbAS.checked = !!c.adstorage;
      $cbAU.checked = !!c.aduserdata;
      $cbAP.checked = !!c.adpersonalization;
    }

    function handle(consent) {
      applyConsent(consent);
      saveConsent(consent);
      hideBanner();
      showManage();
    }

    // --- Event bindings ---
    $accept.addEventListener('click', () => handle({ analytics: true,  adstorage: true,  aduserdata: true,  adpersonalization: true  }));
    $reject.addEventListener('click', () => handle({ analytics: false, adstorage: false, aduserdata: false, adpersonalization: false }));
    $settings.addEventListener('click', () => {
      const saved = loadConsent() || { analytics:false, adstorage:false, aduserdata:false, adpersonalization:false };
      setForm(saved);
      openModal();
    });
    $save.addEventListener('click', () => { handle(readForm()); closeModal(); });
    $denyAll.addEventListener('click', () => { handle({ analytics:false, adstorage:false, aduserdata:false, adpersonalization:false }); closeModal(); });
    $cancel.addEventListener('click', closeModal);
    $manage.addEventListener('click', () => {
      const saved = loadConsent() || { analytics:false, adstorage:false, aduserdata:false, adpersonalization:false };
      setForm(saved);
      openModal();
    });

    // Zavření modalu klikem na pozadí
    $modal.addEventListener('click', (e) => { if (e.target === $modal) closeModal(); });
    // Zavření klávesou Esc
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !$modal.classList.contains('ccy-hidden')) closeModal(); });

    // --- Init ---
    (function init(){
      const saved = loadConsent();
      if (saved) {
        applyConsent(saved);
        hideBanner();
        showManage();
      } else {
        showBanner();
        hideManage();
      }
    })();

    // Mini API (volitelně)
    window.mojraConsent = {
      get: loadConsent,
      apply: (obj) => { applyConsent(obj); saveConsent(obj); },
      openSettings: () => {
        const saved = loadConsent() || { analytics:false, adstorage:false, aduserdata:false, adpersonalization:false };
        setForm(saved);
        openModal();
      }
    };
  </script>
</body>
</html>
